
# create the label column (StringIndex)

from pyspark.ml.feature import  StringIndexer
label_stringIdx = StringIndexer(inputCol = "GenreType", outputCol = "label")
pipelineFit = label_stringIdx.fit(genre_sample)
genre_sample = pipelineFit.transform(genre_sample)
genre_sample.show(5)

#  +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+-----+
#  |    D1|    D2|     D3|     D4|     D5|     D6|      D7|     D10|   A1|     A2|      MSD_TRACKID1|           GenreType|is_electronic|            features|label|
#  +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+-----+
#  |0.6274|6712.0|44180.0|1.606E8| 1.06E9|  7.0E9|7.085E12|2.042E15|2.939|11590.0|TRAABBY128F930C3B5|Rock_Neo_Psychedelia|            0|[0.6274,6712.0,44...| 24.0|
#  | 2.473|3357.0|25210.0| 3.99E7|2.989E8|2.239E9|8.764E11|3.656E14|6.174| 5746.0|TRAABOG128F42955B1|   Rock_Contemporary|            0|[2.473,3357.0,252...| 11.0|
#  |0.9117|3353.0|30930.0|3.994E7|  3.7E8|3.426E9|8.779E11|6.981E14|4.898| 5765.0|TRAABPK128F424CFDB|            Pop_Rock|            0|[0.9117,3353.0,30...|  1.0|
#  | 2.061|6706.0|35240.0|1.604E8|8.681E8|4.693E9| 7.07E12|1.145E15|4.687|11580.0|TRAACLG128F4276511|          Electronic|            1|[2.061,6706.0,352...|  0.0|
#  | 2.061|6706.0|35240.0|1.604E8|8.681E8|4.693E9| 7.07E12|1.145E15|4.687|11580.0|TRAACLG128F4276511|               Dance|            0|[2.061,6706.0,352...| 13.0|
#  +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+-----+
#  only showing top 5 rows

# check the type
 genre_sample.dtypes

#  [('D1', 'double'),
#   ('D2', 'double'),
#   ('D3', 'double'),
#   ('D4', 'double'),
#   ('D5', 'double'),
#   ('D6', 'double'),
#   ('D7', 'double'),
#   ('D10', 'double'),
#   ('A1', 'double'),
#   ('A2', 'double'),
#   ('MSD_TRACKID1', 'string'),
#   ('GenreType', 'string'),
#   ('is_electronic', 'int'),
#   ('features', 'vector'),
#   ('label', 'double')]

# change the type of label into integer

genre_sample = genre_sample.withColumn("labels", F.round(genre_sample.label,2).cast("integer")).drop("label")
genre_sample.show(5)

#   +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+------+
#   |    D1|    D2|     D3|     D4|     D5|     D6|      D7|     D10|   A1|     A2|      MSD_TRACKID1|           GenreType|is_electronic|            features|labels|
#   +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+------+
#   |0.6274|6712.0|44180.0|1.606E8| 1.06E9|  7.0E9|7.085E12|2.042E15|2.939|11590.0|TRAABBY128F930C3B5|Rock_Neo_Psychedelia|            0|[0.6274,6712.0,44...|    24|
#   | 2.473|3357.0|25210.0| 3.99E7|2.989E8|2.239E9|8.764E11|3.656E14|6.174| 5746.0|TRAABOG128F42955B1|   Rock_Contemporary|            0|[2.473,3357.0,252...|    11|
#   |0.9117|3353.0|30930.0|3.994E7|  3.7E8|3.426E9|8.779E11|6.981E14|4.898| 5765.0|TRAABPK128F424CFDB|            Pop_Rock|            0|[0.9117,3353.0,30...|     1|
#   | 2.061|6706.0|35240.0|1.604E8|8.681E8|4.693E9| 7.07E12|1.145E15|4.687|11580.0|TRAACLG128F4276511|          Electronic|            1|[2.061,6706.0,352...|     0|
#   | 2.061|6706.0|35240.0|1.604E8|8.681E8|4.693E9| 7.07E12|1.145E15|4.687|11580.0|TRAACLG128F4276511|               Dance|            0|[2.061,6706.0,352...|    13|
#   +------+------+-------+-------+-------+-------+--------+--------+-----+-------+------------------+--------------------+-------------+--------------------+------+
#   only showing top 5 rows













