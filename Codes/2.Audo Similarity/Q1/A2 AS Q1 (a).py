# pick one of the small dataset :  /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv



#drwxr-xr-x   - hadoop supergroup          0 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv
#-rw-r--r--   8 hadoop supergroup    8635110 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00000.csv.gz
#-rw-r--r--   8 hadoop supergroup    8636689 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00001.csv.gz
#-rw-r--r--   8 hadoop supergroup    8632696 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00002.csv.gz
#-rw-r--r--   8 hadoop supergroup    8635186 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00003.csv.gz
#-rw-r--r--   8 hadoop supergroup    8635805 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00004.csv.gz
#-rw-r--r--   8 hadoop supergroup    8632126 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00005.csv.gz
#-rw-r--r--   8 hadoop supergroup    8636623 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00006.csv.gz
#-rw-r--r--   8 hadoop supergroup    8259803 2018-09-28 12:45 /data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/part-00007.csv.gz

#Load
schema_feature = StructType([
	StructField("D1",DoubleType(),True),
    StructField("D2",DoubleType(),True),
    StructField("D3",DoubleType(),True),
    StructField("D4",DoubleType(),True),
    StructField("D5",DoubleType(),True),
    StructField("D6",DoubleType(),True),
    StructField("D7",DoubleType(),True),
    StructField("D8",DoubleType(),True),
    StructField("D9",DoubleType(),True),
    StructField("D10",DoubleType(),True),
    StructField("A1",DoubleType(),True),
    StructField("A2",DoubleType(),True),
    StructField("A3",DoubleType(),True),
    StructField("A4",DoubleType(),True),
    StructField("A5",DoubleType(),True),
    StructField("A6",DoubleType(),True),
    StructField("A7",DoubleType(),True),
    StructField("A8",DoubleType(),True),
    StructField("A9",DoubleType(),True),
    StructField("A10",DoubleType(),True),
    StructField("MSD_TRACKID",StringType(),True)
])



features =  (
 	        sqlContext
 	        .read
 	        .format("com.databricks.spark.csv")
 	        .option("header","true")
 	        .schema(schema_feature)
            .load("/data/msd/audio/features/msd-jmir-area-of-moments-all-v1.0.csv/*"))

features.show(5,)

# +------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+--------------------+
# |    D1|    D2|     D3|     D4|     D5|      D6|      D7|      D8|      D9|     D10|   A1|     A2|     A3|      A4|      A5|       A6|      A7|      A8|      A9|     A10|         MSD_TRACKID|
# +------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+--------------------+
# |0.9295|6720.0|44100.0|1.608E8| 1.06E9| 6.985E9|7.095E12| 9.545E9|6.293E10|2.037E15|2.666|11580.0|74040.0|-1.792E8|-1.153E9|  -7.42E9|6.242E12|1.037E10| 6.68E10|1.694E15|'TRHFHYX12903CAF953'|
# | 1.883|6712.0|49060.0|1.606E8|1.176E9| 8.609E9|7.083E12|1.058E10|7.744E10|2.781E15| 8.87|11580.0|85200.0|-1.791E8|-1.316E9|  -9.66E9|6.233E12|1.182E10| 8.68E10|2.463E15|'TRHFHAU128F9341A0E'|
# | 1.884|6722.0|56130.0| 1.61E8|1.346E9|1.127E10|7.112E12|1.211E10|1.014E11|4.193E15|4.328|11600.0|93320.0|-1.797E8|-1.459E9|-1.185E10|6.262E12|1.311E10|1.066E11|3.432E15|'TRHFHLP128F14947A7'|
# |  1.52|6709.0|53230.0|1.605E8|1.295E9|1.045E10|7.076E12|1.164E10|9.392E10|3.751E15|8.452|11580.0|93650.0| -1.79E8|-1.441E9|-1.159E10| 6.23E12|1.293E10|1.041E11|3.248E15|'TRHFHFF128F930AC11'|
# | 1.363|6710.0|28750.0|1.605E8|  6.9E8| 2.965E9|7.075E12| 6.194E9|2.663E10|5.621E14|2.787|11580.0|49990.0| -1.79E8|-7.713E8| -3.322E9|6.227E12|  6.92E9|2.983E10| 4.97E14|'TRHFHYJ128F4234782'|
# +------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+--------------------+
# only showing top 5 rows
# 
# ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#here, the strig MSD_TRACKID has a "", that might make trouble for future work , so it need to be removed.

features = features.withColumn(
	"MSD_TRACKID1",
	features.MSD_TRACKID.substr(2,18)).drop("MSD_TRACKID") 

features.show(5,)

#+------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+------------------+
#|    D1|    D2|     D3|     D4|     D5|      D6|      D7|      D8|      D9|     D10|   A1|     A2|     A3|      A4|      A5|       A6|      A7|      A8|      A9|     A10|      MSD_TRACKID1|
#+------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+------------------+
#|0.9295|6720.0|44100.0|1.608E8| 1.06E9| 6.985E9|7.095E12| 9.545E9|6.293E10|2.037E15|2.666|11580.0|74040.0|-1.792E8|-1.153E9|  -7.42E9|6.242E12|1.037E10| 6.68E10|1.694E15|TRHFHYX12903CAF953|
#| 1.883|6712.0|49060.0|1.606E8|1.176E9| 8.609E9|7.083E12|1.058E10|7.744E10|2.781E15| 8.87|11580.0|85200.0|-1.791E8|-1.316E9|  -9.66E9|6.233E12|1.182E10| 8.68E10|2.463E15|TRHFHAU128F9341A0E|
#| 1.884|6722.0|56130.0| 1.61E8|1.346E9|1.127E10|7.112E12|1.211E10|1.014E11|4.193E15|4.328|11600.0|93320.0|-1.797E8|-1.459E9|-1.185E10|6.262E12|1.311E10|1.066E11|3.432E15|TRHFHLP128F14947A7|
#|  1.52|6709.0|53230.0|1.605E8|1.295E9|1.045E10|7.076E12|1.164E10|9.392E10|3.751E15|8.452|11580.0|93650.0| -1.79E8|-1.441E9|-1.159E10| 6.23E12|1.293E10|1.041E11|3.248E15|TRHFHFF128F930AC11|
#| 1.363|6710.0|28750.0|1.605E8|  6.9E8| 2.965E9|7.075E12| 6.194E9|2.663E10|5.621E14|2.787|11580.0|49990.0| -1.79E8|-7.713E8| -3.322E9|6.227E12|  6.92E9|2.983E10| 4.97E14|TRHFHYJ128F4234782|
#+------+------+-------+-------+-------+--------+--------+--------+--------+--------+-----+-------+-------+--------+--------+---------+--------+--------+--------+--------+------------------+
#only showing top 5 rows




# descriptive statistics



  features.drop("MSD_TRACKID1").describe().show()
# -----+--------------------+--------------------+--------------------+------------------+------------------+------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
# |summary|                D1|                D2|                D3|                  D4|                  D5|                  D6|                  D7|                  D8|                  D9|                 D10|                A1|                A2|                A3|                  A4|                  A5|                  A6|                  A7|                  A8|                  A9|                 A10|
# +-------+------------------+------------------+------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------+------------------+------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+
# |  count|            994596|            994596|            994596|              994596|              994596|              994596|              994596|              994596|              994596|              994596|            994596|            994596|            994596|              994596|              994596|              994596|              994596|              994596|              994596|              994596|
# |   mean|1.2289206788057585| 5500.575317251828| 33817.92202667012| 1.276702627543313E8| 7.834845180709708E8| 5.254843319637332E9| 7.77063694777682E12|7.0365639230436945E9|4.722038716852859...|2.323945703218454...| 3.516756553325205| 9476.028822504819|58331.756993630064|-1.42298714184189...|-8.725726211872075E8|-5.857233928246194E9|6.835774999887336E12| 7.828450479084026E9|5.259024722469672...|2.043746067551641...|
# | stddev|0.5282415987515847|2366.0335679423874|18228.683615677088|2.3963938595072412E8|1.5825975198571804E9|1.218937441762088...|5.691696073829758E13|1.424630635717294...|1.097880002453757...|2.456512132172792...|1.8600986376492814|4088.5304956888067|31372.726775152285| 2.671037411661179E8|1.7589145882975984E9|1.358644102023140...|5.008494283928819E13|1.583236844625743...|1.223700843206727...|2.163188013792533...|
# |    min|               0.0|               0.0|               0.0|                 0.0|                 0.0|                 0.0|                 0.0|                 0.0|                 0.0|                 0.0|               0.0|               0.0|               0.0|            -8.802E9|           -9.005E10|           -1.495E12|                 0.0|                 0.0|                 0.0|                 0.0|
# |    max|             9.346|           46860.0|          699400.0|             7.864E9|            8.124E10|            1.453E12|             2.43E15|             7.46E11|             1.31E13|            5.817E18|             26.52|           81350.0|         1003000.0|                 0.0|                 0.0|                 0.0|            2.144E15|            8.335E11|            1.347E13|            4.958E18|
# +-------+------------------+------------------+------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------+------------------+------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+


#correlation

feature1= features.drop("MSD_TRACKID1")

from pyspark.mllib.stat import Statistics
import pandas as pd


df = feature1
col_names = df.columns
features2 = df.filter(~F.col("D1").isNull()).rdd.map(lambda row: row[0:])
corr_mat=Statistics.corr(features2, method="pearson")
corr_df = pd.DataFrame(corr_mat)
corr_df.index, corr_df.columns = col_names, col_names

print(corr_df.to_string())

# data = sc.parallelize(
#     [np.array([1.0, 10.0, 100.0]), np.array([2.0, 20.0, 200.0]), np.array([5.0, 33.0, 366.0])]
# )  # an RDD of Vectors

# # calculate the correlation matrix using Pearson's method. 

 
#                D1        D2        D3        D4        D5        D6        D7        D8        D9       D10        A1        A2        A3        A4        A5        A6        A7        A8        A9       A10
#     D1   1.000000 -0.019972  0.227683  0.013724  0.076597  0.105152  0.024142  0.076524  0.104952  0.045113  0.724619 -0.020836  0.226315 -0.013612 -0.076529 -0.104984  0.024111  0.076397  0.104699  0.044959
#     D2  -0.019972  1.000000  0.786974  0.848547  0.796065  0.699140  0.692397  0.795603  0.698605  0.501698  0.026354  0.999567  0.782581 -0.848483 -0.794765 -0.695878  0.692131  0.794210  0.695302  0.499857
#     D3   0.227683  0.786974  1.000000  0.681866  0.783786  0.794040  0.563799  0.783546  0.793502  0.550791  0.327492  0.786758  0.994414 -0.681874 -0.783322 -0.791363  0.563610  0.782951  0.790680  0.549287
#     D4   0.013724  0.848547  0.681866  1.000000  0.945989  0.837624  0.962426  0.945701  0.837212  0.706433  0.009331  0.846567  0.675535 -0.999961 -0.944002 -0.833638  0.962245  0.943679  0.833230  0.704140
#     D5   0.076597  0.796065  0.783786  0.945989  1.000000  0.964883  0.914948  0.999981  0.964623  0.849023  0.089381  0.794340  0.779299 -0.946023 -0.999485 -0.962367  0.914810  0.999448  0.962095  0.847423
#     D6   0.105152  0.699140  0.794040  0.837624  0.964883  1.000000  0.814394  0.965123  0.999981  0.923738  0.129500  0.697523  0.791113 -0.837580 -0.965340 -0.998560  0.814197  0.965573  0.998509  0.922531
#     D7   0.024142  0.692397  0.563799  0.962426  0.914948  0.814394  1.000000  0.914822  0.814140  0.741348  0.002544  0.690354  0.558052 -0.962579 -0.913194 -0.811050  0.999984  0.913074  0.810831  0.739312
#     D8   0.076524  0.795603  0.783546  0.945701  0.999981  0.965123  0.914822  1.000000  0.964899  0.849679  0.089258  0.793878  0.779069 -0.945736 -0.999475 -0.962624  0.914684  0.999478  0.962391  0.848093
#     D9   0.104952  0.698605  0.793502  0.837212  0.964623  0.999981  0.814140  0.964899  1.000000  0.924281  0.129194  0.696988  0.790588 -0.837168 -0.965089 -0.998560  0.813944  0.965360  0.998550  0.923090
#     D10  0.045113  0.501698  0.550791  0.706433  0.849023  0.923738  0.741348  0.849679  0.924281  1.000000  0.035347  0.499884  0.549731 -0.706266 -0.850114 -0.923494  0.741079  0.850832  0.924060  0.999017
#     A1   0.724619  0.026354  0.327492  0.009331  0.089381  0.129500  0.002544  0.089258  0.129194  0.035347  1.000000  0.027715  0.328804 -0.009473 -0.089838 -0.129688  0.002572  0.089641  0.129272  0.035360
#     A2  -0.020836  0.999567  0.786758  0.846567  0.794340  0.697523  0.690354  0.793878  0.696988  0.499884  0.027715  1.000000  0.783083 -0.846688 -0.793236 -0.694467  0.690171  0.792683  0.693893  0.498142
#     A3   0.226315  0.782581  0.994414  0.675535  0.779299  0.791113  0.558052  0.779069  0.790588  0.549731  0.328804  0.783083  1.000000 -0.675710 -0.781237 -0.792306  0.557946  0.780885  0.791639  0.549867
#     A4  -0.013612 -0.848483 -0.681874 -0.999961 -0.946023 -0.837580 -0.962579 -0.945736 -0.837168 -0.706266 -0.009473 -0.846688 -0.675710  1.000000  0.944124  0.833691 -0.962446 -0.943802 -0.833284 -0.704031
#     A5  -0.076529 -0.794765 -0.783322 -0.944002 -0.999485 -0.965340 -0.913194 -0.999475 -0.965089 -0.850114 -0.089838 -0.793236 -0.781237  0.944124  1.000000  0.964460 -0.913111 -0.999978 -0.964202 -0.849610
#     A6  -0.104984 -0.695878 -0.791363 -0.833638 -0.962367 -0.998560 -0.811050 -0.962624 -0.998560 -0.923494 -0.129688 -0.694467 -0.792306  0.833691  0.964460  1.000000 -0.810918 -0.964722 -0.999978 -0.924358
#     A7   0.024111  0.692131  0.563610  0.962245  0.914810  0.814197  0.999984  0.914684  0.813944  0.741079  0.002572  0.690171  0.557946 -0.962446 -0.913111 -0.810918  1.000000  0.912992  0.810699  0.739086
#     A8   0.076397  0.794210  0.782951  0.943679  0.999448  0.965573  0.913074  0.999478  0.965360  0.850832  0.089641  0.792683  0.780885 -0.943802 -0.999978 -0.964722  0.912992  1.000000  0.964505  0.850349
#     A9   0.104699  0.695302  0.790680  0.833230  0.962095  0.998509  0.810831  0.962391  0.998550  0.924060  0.129272  0.693893  0.791639 -0.833284 -0.964202 -0.999978  0.810699  0.964505  1.000000  0.924946
#     A10  0.044959  0.499857  0.549287  0.704140  0.847423  0.922531  0.739312  0.848093  0.923090  0.999017  0.035360  0.498142  0.549867 -0.704031 -0.849610 -0.924358  0.739086  0.850349  0.924946  1.000000
#  



# from the result, we can find that 

#  correlated strongly.
# D3 and A3
# D4 and A4
# D5 and D8,A5,A8
# D6 and D9,A6,A9
# D7 and A7
# D8 and D5, A5,A8
# D9 and D6,A6,A9
# D10 and A10
# A5 and A8
# A6 and A9
